## Visualización inicial + correlación

```{r}
#| label: scatter_cor
#| fig-cap: "Scatter con línea de regresión entre las variables biil length y flipper length."
# Scatter con línea de regresión (usa df ya limpio)
ggplot(df, aes(x = flipper_length_mm, y = bill_length_mm)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, formula = y ~ x) +
  labs(x = "Flipper length (mm)", y = "Bill length (mm)",
       title = "Relación bill_length_mm ~ flipper_length_mm") +
  theme_minimal()

```
```{r}
#| label: coeficientes_cor
# Correlación Pearson y Spearman (devuelven objetos htest)
cor_pearson <- cor.test(df$flipper_length_mm, df$bill_length_mm, 
                        method = "pearson")
cor_spearman <- cor.test(df$flipper_length_mm, df$bill_length_mm, 
                         method = "spearman")
# Correlación Pearson
pearson_tab <- broom::tidy(cor_pearson) %>%
  select(estimate, statistic, p.value, conf.low, conf.high) %>%
  mutate(
    p.value = ifelse(p.value < 0.001, "< 0.001", round(p.value, 3)),
    across(where(is.numeric), round, 3)
  )

knitr::kable(pearson_tab, caption = "Correlación de Pearson 
             entre bill_length y flipper_length")

# Correlación Spearman
spearman_tab <- broom::tidy(cor_spearman) %>%
  select(estimate, statistic, p.value) %>%
  mutate(
    p.value = ifelse(p.value < 0.001, "< 0.001", round(p.value, 3)),
    across(where(is.numeric), round, 3)
  )

knitr::kable(spearman_tab, caption = "Correlación de Spearman 
             entre bill_length y flipper_length")
```
## Modelo lineal simple

```{r}
#| label: fit_lm
# Ajuste del modelo lineal simple
modelo_lm <- lm(bill_length_mm ~ flipper_length_mm, data = df)

# Coeficientes y resumen del ajuste
tidy_lm <- broom::tidy(modelo_lm)
glance_lm <- broom::glance(modelo_lm)

# Tablas presentables para Quarto
knitr::kable(tidy_lm, caption = "Coeficientes del modelo lineal 
             (bill_length ~ flipper_length)")
knitr::kable(glance_lm, caption = "Resumen del ajuste (R², AIC, BIC, etc.)")

```{r}
#| label: intervals
# IC 95% para coeficientes directamente con confint
ic_coef <- as.data.frame(confint(modelo_lm)) %>%
  tibble::rownames_to_column("term")

knitr::kable(
  ic_coef,
  caption = "Intervalos de confianza (95%) 
  para los coeficientes del modelo lineal",
  digits = 3,
  format = "markdown"
)

